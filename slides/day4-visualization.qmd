---
title: "Data Analysis with R and Claude Code"
subtitle: "Day 4: Data Visualization — Telling Stories with Data"
author: "Fabio Giglietto"
institute: "University of Urbino"
date: "February 12, 2026"
format:
  revealjs:
    theme: [default, uniurb.scss]
    slide-number: true
    preview-links: auto
    logo: ""
    footer: "PhD in Humanities — Scienze della Comunicazione e Cultura Digitale"
    highlight-style: github
    code-line-numbers: false
    code-overflow: wrap
execute:
  echo: true
  eval: false
---

# Welcome Back! {background-color="#2c3e50"}

## Day 3 Recap

::: {.incremental}
- `mutate()` creates new variables
- `case_when()` creates categories
- `summarize()` calculates statistics
- `group_by()` enables grouped operations
- `count()` for frequency tables
- `arrange()` sorts data
:::

## Today's Goals

::: {.incremental}
1. Learn the grammar of graphics
2. Create histograms, bar charts, line plots
3. Build scatter plots with trend lines
4. Use box plots for comparisons
5. Customize colors, labels, and themes
6. Save publication-ready figures
:::

## Setup

```{r}
library(tidyverse)
library(scales)  # For better axis formatting

corona <- read_csv("data/fabrizio_corona_tiktok_jan2026.csv")

# Add our calculated variables
corona <- corona |>
  mutate(
    engagement_total = like_count + comment_count + share_count,
    engagement_rate = engagement_total / view_count,
    duration_category = case_when(
      duration < 30 ~ "short",
      duration >= 30 & duration <= 60 ~ "medium",
      duration > 60 ~ "long"
    )
  )
```

# The Grammar of Graphics {background-color="#2c3e50"}

## ggplot2: Building Plots in Layers

Every plot has:

::: {.incremental}
1. **DATA** — What dataset?
2. **AESTHETICS** — What variables map to x, y, color, size?
3. **GEOMETRIES** — What shapes represent the data?
4. **LAYERS** — Labels, themes, scales...
:::

## The Basic Template

```{r}
ggplot(data = <DATA>, aes(x = <X_VAR>, y = <Y_VAR>)) +
  geom_<TYPE>()
```

. . .

Note: We use `+` to add layers (not `|>`)

## Your First Plot

```{r}
ggplot(data = corona, aes(x = view_count, y = like_count)) +
  geom_point()
```

. . .

- **Data:** corona
- **Aesthetics:** x = view_count, y = like_count
- **Geometry:** points

## Compact Syntax

You can omit `data =` and `x =`, `y =`:

```{r}
ggplot(corona, aes(view_count, like_count)) +
  geom_point()
```

# Histograms {background-color="#2c3e50"}

## geom_histogram(): One Variable Distribution

```{r}
ggplot(corona, aes(x = view_count)) +
  geom_histogram()
```

Shows how values are distributed

## Controlling Bins

```{r}
ggplot(corona, aes(x = view_count)) +
  geom_histogram(bins = 50)
```

. . .

More bins = more detail (but can be noisy)

## Problem: Skewed Data

Most videos have few views, some have millions

. . .

**Solution:** Log scale

```{r}
ggplot(corona, aes(x = view_count)) +
  geom_histogram(bins = 50) +
  scale_x_log10()
```

## Polished Histogram

```{r}
ggplot(corona, aes(x = view_count)) +
  geom_histogram(bins = 50, fill = "steelblue", color = "white") +
  scale_x_log10(labels = label_comma()) +
  labs(
    title = "Distribution of Video Views",
    x = "Views (log scale)",
    y = "Number of Videos"
  )
```

## Duration Histogram

```{r}
ggplot(corona, aes(x = duration)) +
  geom_histogram(bins = 30, fill = "coral", color = "white") +
  labs(
    title = "Distribution of Video Duration",
    x = "Duration (seconds)",
    y = "Count"
  )
```

## Try It: Histogram

Create a histogram of `like_count`

. . .

```{r}
ggplot(corona, aes(x = like_count)) +
  geom_histogram(bins = 50, fill = "steelblue") +
  scale_x_log10(labels = label_comma())
```

# Bar Charts {background-color="#2c3e50"}

## geom_bar(): Counts Categories

```{r}
ggplot(corona, aes(x = duration_category)) +
  geom_bar()
```

. . .

`geom_bar()` **counts for you** automatically

## Ordering Categories

```{r}
corona <- corona |>
  mutate(duration_category = factor(duration_category,
                                    levels = c("short", "medium", "long")))

ggplot(corona, aes(x = duration_category)) +
  geom_bar(fill = "steelblue") +
  labs(
    title = "Videos by Duration Category",
    x = "Duration Category",
    y = "Number of Videos"
  )
```

## geom_col(): Pre-calculated Values

When you've already calculated the values:

```{r}
top_authors <- corona |>
  count(author_name, sort = TRUE) |>
  head(10)

ggplot(top_authors, aes(x = author_name, y = n)) +
  geom_col(fill = "steelblue")
```

## Horizontal Bars with reorder()

```{r}
ggplot(top_authors, aes(x = reorder(author_name, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Top 10 Authors by Number of Videos",
    x = "Author",
    y = "Number of Videos"
  )
```

## geom_bar() vs geom_col()

| Function | When to Use |
|----------|-------------|
| `geom_bar()` | Raw data — R counts for you |
| `geom_col()` | Pre-summarized data with counts |

# Line Plots {background-color="#2c3e50"}

## Preparing Time Series Data

```{r}
daily_stats <- corona |>
  group_by(create_date) |>
  summarize(
    n_videos = n(),
    total_views = sum(view_count),
    avg_views = mean(view_count)
  )
```

## Basic Line Plot

```{r}
ggplot(daily_stats, aes(x = create_date, y = n_videos)) +
  geom_line()
```

## Adding Points

```{r}
ggplot(daily_stats, aes(x = create_date, y = n_videos)) +
  geom_line() +
  geom_point()
```

## Customized Time Series

```{r}
ggplot(daily_stats, aes(x = create_date, y = n_videos)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(color = "steelblue", size = 2) +
  labs(
    title = "Daily TikTok Videos about Fabrizio Corona",
    subtitle = "January 2026",
    x = "Date",
    y = "Number of Videos",
    caption = "Source: TikTok Research API"
  )
```

## Total Daily Views

```{r}
ggplot(daily_stats, aes(x = create_date, y = total_views)) +
  geom_line(color = "coral", linewidth = 1) +
  geom_point(color = "coral", size = 2) +
  scale_y_continuous(labels = label_comma()) +
  labs(
    title = "Total Daily Views",
    x = "Date",
    y = "Total Views"
  )
```

# Scatter Plots {background-color="#2c3e50"}

## geom_point(): Two Variables

```{r}
ggplot(corona, aes(x = view_count, y = like_count)) +
  geom_point()
```

## Problem: Overplotting

Too many points overlap!

. . .

**Solution:** Transparency

```{r}
ggplot(corona, aes(x = view_count, y = like_count)) +
  geom_point(alpha = 0.3)
```

## Log Scales for Skewed Data

```{r}
ggplot(corona, aes(x = view_count, y = like_count)) +
  geom_point(alpha = 0.3) +
  scale_x_log10(labels = label_comma()) +
  scale_y_log10(labels = label_comma())
```

## Color by Category

```{r}
ggplot(corona, aes(x = view_count, y = like_count,
                   color = duration_category)) +
  geom_point(alpha = 0.5) +
  scale_x_log10(labels = label_comma()) +
  scale_y_log10(labels = label_comma()) +
  labs(
    title = "Views vs. Likes by Video Duration",
    x = "Views (log scale)",
    y = "Likes (log scale)",
    color = "Duration"
  )
```

## Adding Trend Lines

```{r}
ggplot(corona, aes(x = view_count, y = like_count)) +
  geom_point(alpha = 0.2) +
  geom_smooth(method = "lm", color = "red") +
  scale_x_log10(labels = label_comma()) +
  scale_y_log10(labels = label_comma()) +
  labs(
    title = "Relationship Between Views and Likes",
    x = "Views (log scale)",
    y = "Likes (log scale)"
  )
```

## geom_smooth() Options

| Method | Description |
|--------|-------------|
| `"lm"` | Linear regression line |
| `"loess"` | Smooth curve (default) |
| `"gam"` | Generalized additive model |

# Box Plots {background-color="#2c3e50"}

## geom_boxplot(): Distributions by Category

```{r}
ggplot(corona, aes(x = duration_category, y = view_count)) +
  geom_boxplot()
```

## Understanding Box Plots

- **Box:** 25th to 75th percentile (middle 50%)
- **Line:** Median (50th percentile)
- **Whiskers:** 1.5 × IQR from box
- **Points:** Outliers beyond whiskers

## Box Plot with Log Scale

```{r}
ggplot(corona, aes(x = duration_category, y = view_count)) +
  geom_boxplot(fill = "steelblue", alpha = 0.7) +
  scale_y_log10(labels = label_comma()) +
  labs(
    title = "View Distribution by Video Duration",
    x = "Duration Category",
    y = "Views (log scale)"
  )
```

## Adding Individual Points

```{r}
ggplot(corona, aes(x = duration_category, y = view_count)) +
  geom_boxplot(fill = "steelblue", alpha = 0.7, outlier.shape = NA) +
  geom_jitter(alpha = 0.1, width = 0.2) +
  scale_y_log10(labels = label_comma()) +
  labs(
    title = "View Distribution by Video Duration",
    x = "Duration Category",
    y = "Views (log scale)"
  )
```

## Engagement by Duration

```{r}
ggplot(corona, aes(x = duration_category, y = engagement_rate)) +
  geom_boxplot(fill = "coral", alpha = 0.7) +
  labs(
    title = "Engagement Rate by Video Duration",
    x = "Duration Category",
    y = "Engagement Rate"
  )
```

# Customization {background-color="#2c3e50"}

## Themes: Change the Overall Look

```{r}
p <- ggplot(daily_stats, aes(x = create_date, y = n_videos)) +
  geom_line(color = "steelblue", linewidth = 1)
```

## Built-in Themes

```{r}
p + theme_gray()     # Default
p + theme_minimal()  # Clean, minimal
p + theme_bw()       # Black and white
p + theme_classic()  # No gridlines
```

## Theme Comparison

| Theme | Best For |
|-------|----------|
| `theme_minimal()` | Clean presentations |
| `theme_bw()` | Print publications |
| `theme_classic()` | Simple, traditional look |
| `theme_void()` | Maps, diagrams |

## Colors: Named Colors

```{r}
ggplot(corona, aes(x = duration_category)) +
  geom_bar(fill = "darkgreen")
```

Common colors: `"steelblue"`, `"coral"`, `"darkgreen"`, `"purple"`, `"orange"`

## Colors: Hex Codes

```{r}
ggplot(corona, aes(x = duration_category)) +
  geom_bar(fill = "#1DA1F2")  # Twitter blue
```

. . .

Find colors at: [colorhunt.co](https://colorhunt.co) or [coolors.co](https://coolors.co)

## Custom Color Scales

```{r}
ggplot(corona, aes(x = duration_category, fill = duration_category)) +
  geom_bar() +
  scale_fill_manual(values = c("short" = "#FF6B6B",
                               "medium" = "#4ECDC4",
                               "long" = "#45B7D1"))
```

## Labels with labs()

```{r}
ggplot(daily_stats, aes(x = create_date, y = n_videos)) +
  geom_line() +
  labs(
    title = "Main Title",
    subtitle = "Smaller subtitle",
    x = "X Axis Label",
    y = "Y Axis Label",
    caption = "Source: Your data source",
    color = "Legend Title"
  )
```

## Publication-Ready Plot

```{r}
ggplot(daily_stats, aes(x = create_date, y = n_videos)) +
  geom_line(color = "#1DA1F2", linewidth = 1) +
  geom_point(color = "#1DA1F2", size = 2) +
  labs(
    title = "Daily TikTok Videos about Fabrizio Corona",
    subtitle = "January 2026",
    x = NULL,
    y = "Number of Videos",
    caption = "Source: TikTok Research API"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(color = "gray50"),
    panel.grid.minor = element_blank()
  )
```

# Saving Plots {background-color="#2c3e50"}

## ggsave(): Export Your Figures

```{r}
# Save the last plot
ggsave("output/daily_videos.png", width = 10, height = 6, dpi = 300)
```

## Save a Specific Plot

```{r}
my_plot <- ggplot(daily_stats, aes(x = create_date, y = n_videos)) +
  geom_line(color = "steelblue") +
  theme_minimal() +
  labs(title = "Daily Video Count")

ggsave("output/my_plot.png", plot = my_plot, width = 10, height = 6)
```

## File Formats

```{r}
ggsave("output/plot.png", width = 10, height = 6, dpi = 300)  # Web
ggsave("output/plot.pdf", width = 10, height = 6)             # Print
ggsave("output/plot.svg", width = 10, height = 6)             # Vector
```

| Format | Best For |
|--------|----------|
| PNG | Web, presentations |
| PDF | Publications, print |
| SVG | Editable graphics |

# Chart Selection Guide {background-color="#2c3e50"}

## Which Chart to Use?

| Question | Chart Type |
|----------|------------|
| Distribution of one variable? | Histogram |
| Counts by category? | Bar chart |
| Trend over time? | Line plot |
| Relationship between two variables? | Scatter plot |
| Compare distributions across groups? | Box plot |

# Exercises {background-color="#2c3e50"}

## Exercise 1

Create a histogram of video duration

. . .

```{r}
ggplot(corona, aes(x = duration)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "white")
```

## Exercise 2

Create a bar chart of top 10 authors

. . .

```{r}
top_authors <- corona |>
  count(author_name, sort = TRUE) |>
  head(10)

ggplot(top_authors, aes(x = reorder(author_name, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip()
```

## Exercise 3

Create a line plot of total daily views

. . .

```{r}
ggplot(daily_stats, aes(x = create_date, y = total_views)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = label_comma())
```

## Exercise 4

Create a scatter plot of views vs comments with log scales

. . .

```{r}
ggplot(corona, aes(x = view_count, y = comment_count)) +
  geom_point(alpha = 0.3) +
  scale_x_log10() +
  scale_y_log10()
```

## Exercise 5

Make one plot publication-ready and save it

. . .

```{r}
my_plot <- ggplot(daily_stats, aes(x = create_date, y = n_videos)) +
  geom_line(color = "steelblue", linewidth = 1) +
  labs(title = "Daily Videos", x = "Date", y = "Count") +
  theme_minimal()

ggsave("output/my_plot.png", my_plot, width = 10, height = 6)
```

# Key Takeaways {background-color="#2c3e50"}

## Today We Learned

::: {.incremental}
1. **ggplot2** builds plots in layers
2. **`geom_histogram()`** for distributions
3. **`geom_bar()`** / **`geom_col()`** for categories
4. **`geom_line()`** for time series
5. **`geom_point()`** for scatter plots
6. **`geom_boxplot()`** for group comparisons
7. **`scale_*_log10()`** for skewed data
8. **`labs()`** + **`theme_*()`** for customization
9. **`ggsave()`** to export figures
:::

# Homework {background-color="#2c3e50"}

## Before Day 5

**Create three visualizations:**

1. Distribution of engagement rate (histogram)
2. Top 10 days by total views (bar chart)
3. Views vs. shares relationship (scatter plot)

. . .

**Save your favorite as a PNG file**

. . .

**Ask Claude Code:**

> "How do I add multiple geoms to the same ggplot?"

# See You Tomorrow! {background-color="#2c3e50"}

**Day 5: Text Analysis & Capstone**

- Analyze hashtags
- Word frequency analysis
- Capstone project
- Resources for continuing your journey
